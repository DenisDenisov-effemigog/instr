<template>
    <div class="finance__layout" v-if="arrears && lengthOfArrears > 0 || !arrears && lengthOfNotArrears">
        <h4 class="finance__subtitle" v-if="arrears">{{ $tc('profile_finance.title.arrears') }}</h4>
        <h4 class="finance__subtitle" v-else>
            {{ $tc('profile_finance.title.charges', lengthOfNotArrears) }} {{ currency(sum) }} {{ $tc('text.currency') }}
        </h4>
        <ul class="finance-charges"
            :class="{'finance-charges--arrears': arrears, 'finance-charges--expanded': expanded}"
        >
            <li class="finance-charges__item finance-charges__item--head">
                <div class="finance-charges__sum">{{ $tc('profile_finance.head.sum') }}</div>
                <div class="finance-charges__date">{{ $tc('profile_finance.head.date') }}</div>
                <div class="finance-charges__left-days">{{ $tc('profile_finance.head.left_days') }}</div>
            </li>
            <li class="finance-charges__item" v-for="item in charges" v-if="arrears && item.days < 0">
                <div class="finance-charges__sum">{{ currency(item.sum) }} {{ $tc('text.currency') }}</div>
                <div class="finance-charges__date">{{ item.date }}</div>
                <div class="finance-charges__left-days finance-charges__left-days--arrears">
                    - {{ $tc('profile_finance.days', -item.days) }}
                </div>
            </li>
            <li class="finance-charges__item" v-for="item in charges" v-if="!arrears && item.days >= 0">
                <div class="finance-charges__sum">{{ currency(item.sum) }} {{ $tc('text.currency') }}</div>
                <div class="finance-charges__date">{{ item.date }}</div>
                <div class="finance-charges__left-days">
                    {{ $tc('profile_finance.days', item.days) }}
                </div>
            </li>
        </ul>
        <a v-if="arrears && !expanded && lengthOfArrears > 3" 
            class="profile__link" 
            @click.prevent="expanded = true"
        >
            {{ $tc('profile_finance.deploy_fees') }}
            <svg viewBox="-7 -6 20 20">
                <use :xlink:href="templatePath + 'images/sprite.svg#arrows__arrow-down'"></use>
            </svg>
        </a>
        <a v-else-if="!arrears && !expanded && lengthOfNotArrears > 3"
            class="profile__link" 
            @click.prevent="expanded = true"
        >
            {{ $tc('profile_finance.deploy_fees') }}
            <svg viewBox="-7 -6 20 20">
                <use :xlink:href="templatePath + 'images/sprite.svg#arrows__arrow-down'"></use>
            </svg>
        </a>
    </div>
</template>

<script>
    export default {
        name: 'finance-charges',
        props: {
            financeCharges: {
                type: Array
            },
            arrears: {
                type: Boolean,
                default: false
            }
        },
        data() {
            return {
                expanded: false,
                sum: 0
            }
        },
        computed: {
            charges() {
                return this.financeCharges
            },
            lengthOfArrears() {
                let count = 0;
                this.charges.forEach(item => {
                    if (item.days < 0) count++
                })
                return count
            },
            lengthOfNotArrears() {
                let count = 0;
                this.charges.forEach(item => {
                    if (item.days >= 0) {
                        count++;
                        this.sum += item.sum
                    }
                })
                return count
            },
        }
    }
</script>

<style>

</style>