<template>
    <form class="user-reg__form"
        @submit.prevent="submit">
        <label name="reason" class="user-reg__radio">
            <input
                type="radio"
                name="entity"
                value="legal"
                @click ='IndividualFlag = false'
                checked>
            <span class="user-reg__check"></span>
            <span class="user-reg__radio-label">{{ $tc('title.person_corporate') }}</span>
        </label>
        <label name="reason" class="user-reg__radio">
            <input
                type="radio"
                name="entity"
                value="individual"
                @click ='IndividualFlag = true'>
            <span class="user-reg__check"></span>
            <span class="user-reg__radio-label">{{ $tc('title.person_individual') }}</span>
        </label>
        <label v-show="!IndividualFlag" name="taxPayer" class="user-reg__checkbox">
            <input
                class="user-reg__checkbox-input"
                type="checkbox"
                name="taxPayer">
            <span class="user-reg__checkbox-slider"></span>
            <span class="user-reg__checkbox-label">{{ $tc('user_reg.tax_payer') }}</span>
        </label>
        <label name="name" class="user__label">
            <input
                v-if="!IndividualFlag"
                class="user__input"
                :class="{'user__input--error': $v.name.$error}"
                type="text"
                name="name"
                id="name"
                autocomplete="name"
                autocorrect="off"
                v-model.trim="$v.name.$model">
            <input
                v-else
                class="user__input"
                :class="{'user__input--error': $v.name.$error}"
                type="text"
                name="name"
                id="name"
                autocomplete="name"
                autocorrect="off"
                v-model.trim="$v.name.$model">
            <span v-if="!IndividualFlag" class="user__label-text"
                :class="{'user__label-text--up': $v.name.required}"
            >{{ $tc('title.person') }}</span>
            <span v-else class="user__label-text"
                :class="{'user__label-text--up': $v.name.required}"
            >{{ $tc('user_reg.name') }}</span>
            <svg viewBox="0 0 24 24"
                class="user__label-icon"
                v-if="$v.name.required"
                @click="$v.name.$model = ''">
                <use :xlink:href="templatePath + 'images/sprite.svg#icons__times-small'"></use>
            </svg>
            <div class="user__error-text user__error-text--invalid"
                v-if="$v.name.$error">{{ $tc('text.error') }}</div>
        </label>
        <label v-show="!IndividualFlag" name="company" class="user__label">
            <input
                class="user__input"
                :class="{'user__input--error': $v.company.$error}"
                type="text"
                name="company"
                id="company"
                autocomplete="organization"
                autocorrect="off"
                v-model.trim="$v.company.$model">
            <span class="user__label-text"
                :class="{'user__label-text--up': $v.company.required}"
            >{{ $tc('title.company') }}</span>
            <svg viewBox="0 0 24 24"
                class="user__label-icon" 
                v-if="$v.company.required"
                @click="$v.company.$model = ''">
                <use :xlink:href="templatePath + 'images/sprite.svg#icons__times-small'"></use>
            </svg>
            <div class="user__error-text user__error-text--invalid"
                v-if="$v.company.$error">{{ $tc('text.error') }}</div>
        </label>
        <label v-show="!IndividualFlag" name="TIN" class="user__label">
            <input
                class="user__input"
                :class="{'user__input--error': $v.tin.$error}"
                type="text"
                name="TIN"
                id="TIN"
                v-model.trim="$v.tin.$model">
            <span class="user__label-text"
                :class="{'user__label-text--up': $v.tin.required}"
            >{{ $tc('title.tin') }}</span>
            <svg viewBox="0 0 24 24"
                class="user__label-icon"
                v-if="$v.tin.required"
                @click="$v.tin.$model = ''">
                <use :xlink:href="templatePath + 'images/sprite.svg#icons__times-small'"></use>
            </svg>
            <div class="user__error-text user__error-text--invalid"
                v-if="$v.company.$error">{{ $tc('text.error') }}</div>
        </label>
        <label name="phone" class="user__label">
            <the-mask
                class="user__input"
                :class="{'user__input--error': $v.phone.$error}"
                type="tel"
                :mask="phoneMask"
                :tokens="tokens"
                name="phone"
                id="phone"
                autocomplete="tel"
                autocorrect="off"
                v-model.trim="phone"/>
            <span class="user__label-text"
                :class="{'user__label-text--up': $v.phone.required}"
            >{{ $tc('title.phone_number') }}</span>
            <svg viewBox="0 0 24 24"
                class="user__label-icon"
                v-if="$v.phone.required"
                @click="$v.phone.$model = ''">
                <use :xlink:href="templatePath + 'images/sprite.svg#icons__times-small'"></use>
            </svg>
            <div class="user__error-text user__error-text--invalid"
                v-if="$v.phone.$error">{{ $tc('text.error') }}</div>
        </label>
        <label name="email" class="user__label">
            <input
                class="user__input"
                :class="{'user__input--error': $v.newEmail.$error}"
                type="email"
                name="email"
                id="email"
                autocomplete="email"
                autocorrect="off"
                autocapitalize="off"
                v-model.trim="newEmail">
            <span class="user__label-text"
                :class="{'user__label-text--up': $v.newEmail.required}"
            >{{ $tc('title.email') }}</span>
            <svg viewBox="0 0 24 24"
                class="user__label-icon"
                v-if="$v.newEmail.required"
                @click="$v.newEmail.$model = ''">
                <use :xlink:href="templatePath + 'images/sprite.svg#icons__times-small'"></use>
            </svg>
            <div class="user__error-text user__error-text--invalid"
                v-if="$v.newEmail.$error">{{ $tc('text.error') }}</div>
        </label>
        <div class="user__error-text" v-if="$v.error">*{{ $tc('text.required') }}</div>
        <label name="agreement" class="user__label user__label_row">
            <input
                class="user__checkbox"
                type="checkbox"
                name="agreement"
                required
                checked
            >
            <span class="user__checkbox-label">
                <svg class="user__checkbox-svg" viewBox="0 0 10 8">
                    <use :xlink:href="templatePath + 'images/sprite.svg#icons__checked'"></use>
                </svg>
            </span>
            <span class="user__checkbox-text">{{ $tc('user_reg.agreement') }}</span>
        </label>
        <input type="submit" class="user__button" value="Зарегистрироваться">
    </form>
</template>

<script>
    import {required, minLength, email, alphaNum} from "vuelidate/lib/validators"
    import {TheMask} from 'vue-the-mask'
    
    import config from "../../../config";

    export default {
        name:'user-reg',
        components: {
            TheMask
        },
        props: {
        },
        validations: {
            name: {
                required
            },
            company: {
                required
            },
            tin: {
                required,
                alphaNum
            },
            phone: {
                required
            },
            newEmail: {
                required,
                email
            }
        },
        data() {
            return {
                IndividualFlag: false,
                name: '',
                company: '',
                tin: '',
                phone: '',
                newEmail: '',
                tokens: config.phoneTokens,
                phoneMask: config.phoneMask
            }
        },
        methods: {
            submit() {
                this.$v.$touch();
                if (!this.$v.$invalid) {
                    this.saveChanges();
                }
            },
            saveChanges() {
               this.name = this.$v.name.$model;
               this.company = this.$v.company.$model;
               this.tin = this.$v.tin.$model;
               this.phone = this.$v.phone.$model;
               this.newEmail = this.$v.newEmail.$model;
            }
        }
    }
</script>